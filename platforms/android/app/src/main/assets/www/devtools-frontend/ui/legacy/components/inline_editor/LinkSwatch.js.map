{"version":3,"file":"LinkSwatch.js","sourceRoot":"","sources":["../../../../../../../../front_end/ui/legacy/components/inline_editor/LinkSwatch.ts"],"names":[],"mappings":"AAAA,gEAAgE;AAChE,yEAAyE;AACzE,6BAA6B;AAE7B,OAAO,KAAK,IAAI,MAAM,+BAA+B,CAAC;AACtD,OAAO,KAAK,QAAQ,MAAM,uCAAuC,CAAC;AAClE,OAAO,KAAK,gBAAgB,MAAM,wCAAwC,CAAC;AAC3E,OAAO,KAAK,OAAO,MAAM,+BAA+B,CAAC;AAEzD,OAAO,gBAAgB,MAAM,qBAAqB,CAAC;AAEnD,MAAM,SAAS,GAAG;IAChB;;;OAGG;IACH,aAAa,EAAE,sBAAsB;CACtC,CAAC;AACF,MAAM,IAAI,GAAG,IAAI,CAAC,IAAI,CAAC,iBAAiB,CAAC,kDAAkD,EAAE,SAAS,CAAC,CAAC;AACxG,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;AACtE,MAAM,EAAC,MAAM,EAAE,IAAI,EAAE,UAAU,EAAC,GAAG,OAAO,CAAC;AAU3C,MAAM,cAAe,SAAQ,WAAW;IACtC,MAAM,CAAU,UAAU,GAAG,OAAO,CAAC,OAAO,CAAA,2BAA2B,CAAC;IACrD,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC,CAAC;IACpD,cAAc,GAAgE,GAAG,EAAE,CAAC,SAAS,CAAC;IAExG,iBAAiB;QACf,IAAI,CAAC,MAAM,CAAC,kBAAkB,GAAG,CAAC,gBAAgB,CAAC,CAAC;IACtD,CAAC;IAED,IAAI,IAAI,CAAC,IAA8B;QACrC,IAAI,CAAC,cAAc,GAAG,CAAC,QAAgB,EAAE,KAA+B,EAAQ,EAAE;YAChF,IAAI,KAAK,YAAY,UAAU,IAAI,KAAK,CAAC,MAAM,KAAK,CAAC,EAAE;gBACrD,OAAO;aACR;YAED,IAAI,KAAK,YAAY,aAAa,IAAI,CAAC,QAAQ,CAAC,iBAAiB,CAAC,iBAAiB,CAAC,KAAK,CAAC,EAAE;gBAC1F,OAAO;aACR;YAED,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;YAC9B,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;QACtB,CAAC,CAAC;QACF,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,KAAK,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;QACtE,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACpB,CAAC;IAEO,MAAM,CAAC,IAA8B;QAC3C,MAAM,EAAC,SAAS,EAAE,IAAI,EAAE,KAAK,EAAC,GAAG,IAAI,CAAC;QACtC,MAAM,OAAO,GAAG,UAAU,CAAC,QAAQ,CAAC;YAClC,kBAAkB,EAAE,IAAI;YACxB,WAAW,EAAE,CAAC,SAAS;SACxB,CAAC,CAAC;QACH,uFAAuF;QACvF,MAAM,UAAU,GAAG,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QAElF,6FAA6F;QAC7F,+DAA+D;QAC/D,MAAM,CACF,IAAI,CAAA,eAAe,OAAO,UAAU,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,eAC3F,OAAO,CAAC,UAAU,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC,eAAe,UAAU,aACrF,UAAU,8BAA8B,IAAI,SAAS,EACzD,IAAI,CAAC,MAAM,EAAE,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;IACjC,CAAC;;AAGH,MAAM,uBAAuB,GAAG,4DAA4D,CAAC;AAgB7F,MAAM,OAAO,YAAa,SAAQ,WAAW;IAC3C,MAAM,CAAU,UAAU,GAAG,OAAO,CAAC,OAAO,CAAA,yBAAyB,CAAC;IACnD,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC,CAAC;IAE9D;QACE,KAAK,EAAE,CAAC;QAER,IAAI,CAAC,QAAQ,GAAG,CAAC,CAAC,CAAC;QAEnB,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE;YAClC,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAc,eAAe,CAAC,CAAC;YAErE,IAAI,IAAI,EAAE;gBACR,IAAI,CAAC,KAAK,EAAE,CAAC;aACd;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAED,IAAI,IAAI,CAAC,IAA4B;QACnC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACpB,CAAC;IAEO,0BAA0B,CAAC,IAAY;QAC7C,sEAAsE;QACtE,sEAAsE;QACtE,sBAAsB;QACtB,MAAM,MAAM,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,EAAE,GAAG,CAAC,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;QAC3E,IAAI,CAAC,MAAM,EAAE;YACX,OAAO,IAAI,CAAC;SACb;QAED,OAAO;YACL,iBAAiB;YACjB,GAAG,EAAE,MAAM,CAAC,CAAC,CAAC;YAEd,8CAA8C;YAC9C,YAAY,EAAE,MAAM,CAAC,CAAC,CAAC;YAEvB,uEAAuE;YACvE,+BAA+B;YAC/B,oBAAoB,EAAE,MAAM,CAAC,CAAC,CAAC;YAE/B,cAAc;YACd,IAAI,EAAE,MAAM,CAAC,CAAC,CAAC;SAChB,CAAC;IACJ,CAAC;IAEO,YAAY,CAAC,IAAY;QAC/B,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;QAClD,IAAI,KAAK,EAAE;YACT,OAAO,KAAK,CAAC,CAAC,CAAC,CAAC;SACjB;QACD,OAAO,EAAE,CAAC;IACZ,CAAC;IAES,MAAM,CAAC,IAA4B;QAC3C,MAAM,EAAC,IAAI,EAAE,YAAY,EAAE,aAAa,EAAE,cAAc,EAAC,GAAG,IAAI,CAAC;QACjE,MAAM,aAAa,GAAG,IAAI,CAAC,0BAA0B,CAAC,IAAI,CAAC,CAAC;QAC5D,IAAI,CAAC,aAAa,EAAE;YAClB,MAAM,CAAC,EAAE,EAAE,IAAI,CAAC,MAAM,EAAE,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;YACtC,OAAO;SACR;QAED,MAAM,SAAS,GAAG,OAAO,CAAC,aAAa,CAAC,IAAI,CAAC,YAAY,CAAC;QAC1D,MAAM,KAAK,GAAG,SAAS,CAAC,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,aAAa,EAAE,EAAC,GAAG,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,EAAC,CAAC,CAAC;QAC9G,MAAM,oBAAoB,GAAG,aAAa,CAAC,oBAAoB,CAAC,CAAC,CAAC,aAAa,CAAC,oBAAoB,CAAC,CAAC,CAAC,EAAE,CAAC;QAE1G,MAAM,CACF,IAAI,CAAA,oBAAoB,IAAI,CAAC,aAAa,IAAI,EAAE,IAAI,aAAa,CAAC,GAAG,IAAI,cAAc,CAAC,UAAU,UAC9F,EAAC,KAAK,EAAE,SAAS,EAAE,KAAK,EAAE,IAAI,EAAE,aAAa,CAAC,YAAY,EAAE,SAAS,EAAE,cAAc,EACjE,2BAA2B,cAAc,CAAC,UAAU,IAAI,oBAAoB,GAChG,aAAa,CAAC,IAAI,SAAS,EAC/B,IAAI,CAAC,MAAM,EAAE,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;IACjC,CAAC;;AASH,MAAM,OAAO,UAAW,SAAQ,WAAW;IACzC,MAAM,CAAU,UAAU,GAAG,OAAO,CAAC,OAAO,CAAA,sBAAsB,CAAC;IAChD,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC,CAAC;IAE9D,IAAI,IAAI,CAAC,IAA0B;QACjC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IACpB,CAAC;IAES,MAAM,CAAC,IAA0B;QACzC,MAAM,EAAC,IAAI,EAAE,SAAS,EAAE,cAAc,EAAC,GAAG,IAAI,CAAC;QAC/C,MAAM,KAAK,GAAG,SAAS,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,UAAU,CAAC,SAAS,CAAC,aAAa,EAAE,EAAC,GAAG,EAAE,IAAI,EAAC,CAAC,CAAC;QAClF,MAAM,CACF,IAAI,CAAA,eAAe,IAAI,CAAC,IAAI,KAAK,cAAc,CAAC,UAAU,UAAU;YAClE,IAAI;YACJ,SAAS;YACT,KAAK;YACL,cAAc;SACS,MAAM,cAAc,CAAC,UAAU,UAAU,EAClE,IAAI,CAAC,MAAM,EAAE,EAAC,IAAI,EAAE,IAAI,EAAC,CAAC,CAAC;IACjC,CAAC;;AAGH,gBAAgB,CAAC,cAAc,CAAC,eAAe,CAAC,2BAA2B,EAAE,cAAc,CAAC,CAAC;AAC7F,gBAAgB,CAAC,cAAc,CAAC,eAAe,CAAC,sBAAsB,EAAE,UAAU,CAAC,CAAC;AACpF,gBAAgB,CAAC,cAAc,CAAC,eAAe,CAAC,yBAAyB,EAAE,YAAY,CAAC,CAAC","sourcesContent":["// Copyright (c) 2020 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as Platform from '../../../../core/platform/platform.js';\nimport * as ComponentHelpers from '../../../components/helpers/helpers.js';\nimport * as LitHtml from '../../../lit-html/lit-html.js';\n\nimport linkSwatchStyles from './linkSwatch.css.js';\n\nconst UIStrings = {\n  /**\n   *@description Text displayed in a tooltip shown when hovering over a var() CSS function in the Styles pane when the custom property in this function does not exist. The parameter is the name of the property.\n   *@example {--my-custom-property-name} PH1\n   */\n  sIsNotDefined: '{PH1} is not defined',\n};\nconst str_ = i18n.i18n.registerUIStrings('ui/legacy/components/inline_editor/LinkSwatch.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\nconst {render, html, Directives} = LitHtml;\n\ninterface BaseLinkSwatchRenderData {\n  text: string;\n  title: string;\n  showTitle: boolean;\n  isDefined: boolean;\n  onLinkActivate: (linkText: string) => void;\n}\n\nclass BaseLinkSwatch extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-base-link-swatch`;\n  protected readonly shadow = this.attachShadow({mode: 'open'});\n  protected onLinkActivate: (linkText: string, event: MouseEvent|KeyboardEvent) => void = () => undefined;\n\n  connectedCallback(): void {\n    this.shadow.adoptedStyleSheets = [linkSwatchStyles];\n  }\n\n  set data(data: BaseLinkSwatchRenderData) {\n    this.onLinkActivate = (linkText: string, event: MouseEvent|KeyboardEvent): void => {\n      if (event instanceof MouseEvent && event.button !== 0) {\n        return;\n      }\n\n      if (event instanceof KeyboardEvent && !Platform.KeyboardUtilities.isEnterOrSpaceKey(event)) {\n        return;\n      }\n\n      data.onLinkActivate(linkText);\n      event.consume(true);\n    };\n    data.showTitle = data.showTitle === undefined ? true : data.showTitle;\n    this.render(data);\n  }\n\n  private render(data: BaseLinkSwatchRenderData): void {\n    const {isDefined, text, title} = data;\n    const classes = Directives.classMap({\n      'link-swatch-link': true,\n      'undefined': !isDefined,\n    });\n    // The linkText's space must be removed, otherwise it cannot be triggered when clicked.\n    const onActivate = isDefined ? this.onLinkActivate.bind(this, text.trim()) : null;\n\n    // We added var popover, so don't need the title attribute when no need for showing title and\n    // only provide the data-title for the popover to get the data.\n    render(\n        html`<span class=${classes} title=${LitHtml.Directives.ifDefined(data.showTitle ? title : null)} data-title=${\n            LitHtml.Directives.ifDefined(!data.showTitle ? title : null)} @mousedown=${onActivate} @keydown=${\n            onActivate} role=\"link\" tabindex=\"-1\">${text}</span>`,\n        this.shadow, {host: this});\n  }\n}\n\nconst VARIABLE_FUNCTION_REGEX = /(^var\\()\\s*(--(?:[\\s\\w\\P{ASCII}-]|\\\\.)+)(,?\\s*.*)\\s*(\\))$/u;\n\ninterface CSSVarSwatchRenderData {\n  text: string;\n  computedValue: string|null;\n  fromFallback: boolean;\n  onLinkActivate: (linkText: string) => void;\n}\n\ninterface ParsedVariableFunction {\n  pre: string;\n  variableName: string;\n  fallbackIncludeComma: string;\n  post: string;\n}\n\nexport class CSSVarSwatch extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-css-var-swatch`;\n  protected readonly shadow = this.attachShadow({mode: 'open'});\n\n  constructor() {\n    super();\n\n    this.tabIndex = -1;\n\n    this.addEventListener('focus', () => {\n      const link = this.shadow.querySelector<HTMLElement>('[role=\"link\"]');\n\n      if (link) {\n        link.focus();\n      }\n    });\n  }\n\n  set data(data: CSSVarSwatchRenderData) {\n    this.render(data);\n  }\n\n  private parseVariableFunctionParts(text: string): ParsedVariableFunction|null {\n    // When the value of CSS var() is greater than two spaces, only one is\n    // always displayed, and the actual number of spaces is displayed when\n    // editing is clicked.\n    const result = text.replace(/\\s{2,}/g, ' ').match(VARIABLE_FUNCTION_REGEX);\n    if (!result) {\n      return null;\n    }\n\n    return {\n      // Returns `var(`\n      pre: result[1],\n\n      // Returns the CSS variable name, e.g. `--foo`\n      variableName: result[2],\n\n      // Returns the fallback value in the CSS variable, including a comma if\n      // one is present, e.g. `,50px`\n      fallbackIncludeComma: result[3],\n\n      // Returns `)`\n      post: result[4],\n    };\n  }\n\n  private variableName(text: string): string {\n    const match = text.match(VARIABLE_FUNCTION_REGEX);\n    if (match) {\n      return match[2];\n    }\n    return '';\n  }\n\n  protected render(data: CSSVarSwatchRenderData): void {\n    const {text, fromFallback, computedValue, onLinkActivate} = data;\n    const functionParts = this.parseVariableFunctionParts(text);\n    if (!functionParts) {\n      render('', this.shadow, {host: this});\n      return;\n    }\n\n    const isDefined = Boolean(computedValue) && !fromFallback;\n    const title = isDefined ? computedValue : i18nString(UIStrings.sIsNotDefined, {PH1: this.variableName(text)});\n    const fallbackIncludeComma = functionParts.fallbackIncludeComma ? functionParts.fallbackIncludeComma : '';\n\n    render(\n        html`<span data-title=${data.computedValue || ''}>${functionParts.pre}<${BaseLinkSwatch.litTagName} .data=${\n            {title, showTitle: false, text: functionParts.variableName, isDefined, onLinkActivate} as\n            LinkSwatchRenderData} class=\"css-var-link\"></${BaseLinkSwatch.litTagName}>${fallbackIncludeComma}${\n            functionParts.post}</span>`,\n        this.shadow, {host: this});\n  }\n}\n\ninterface LinkSwatchRenderData {\n  isDefined: boolean;\n  text: string;\n  onLinkActivate: (linkText: string) => void;\n}\n\nexport class LinkSwatch extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-link-swatch`;\n  protected readonly shadow = this.attachShadow({mode: 'open'});\n\n  set data(data: LinkSwatchRenderData) {\n    this.render(data);\n  }\n\n  protected render(data: LinkSwatchRenderData): void {\n    const {text, isDefined, onLinkActivate} = data;\n    const title = isDefined ? text : i18nString(UIStrings.sIsNotDefined, {PH1: text});\n    render(\n        html`<span title=${data.text}><${BaseLinkSwatch.litTagName} .data=${{\n          text,\n          isDefined,\n          title,\n          onLinkActivate,\n        } as LinkSwatchRenderData}></${BaseLinkSwatch.litTagName}></span>`,\n        this.shadow, {host: this});\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-base-link-swatch', BaseLinkSwatch);\nComponentHelpers.CustomElements.defineComponent('devtools-link-swatch', LinkSwatch);\nComponentHelpers.CustomElements.defineComponent('devtools-css-var-swatch', CSSVarSwatch);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-base-link-swatch': BaseLinkSwatch;\n    'devtools-link-swatch': LinkSwatch;\n    'devtools-css-var-swatch': CSSVarSwatch;\n  }\n}\n"]}