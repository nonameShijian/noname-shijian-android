{"version":3,"file":"SharedStorageMetadataView.js","sourceRoot":"","sources":["../../../../../../../front_end/panels/application/components/SharedStorageMetadataView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2022 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../core/i18n/i18n.js';\nimport type * as Protocol from '../../../generated/protocol.js';\nimport * as ComponentHelpers from '../../../ui/components/helpers/helpers.js';\nimport * as IconButton from '../../../ui/components/icon_button/icon_button.js';\nimport * as LitHtml from '../../../ui/lit-html/lit-html.js';\n\nimport sharedStorageMetadataViewStyles from './sharedStorageMetadataView.css.js';\nimport sharedStorageMetadataViewResetBudgetButtonStyles from './sharedStorageMetadataViewResetBudgetButton.css.js';\nimport {StorageMetadataView} from './StorageMetadataView.js';\n\nconst UIStrings = {\n  /**\n   *@description Text in SharedStorage Metadata View of the Application panel\n   */\n  sharedStorage: 'Shared Storage',\n  /**\n   *@description The time when the origin most recently created its shared storage database\n   */\n  creation: 'Creation Time',\n  /**\n   *@description The placeholder text if there is no creation time because the origin is not yet using shared storage.\n   */\n  notYetCreated: 'Not yet created',\n  /**\n   *@description The number of entries currently in the origin's database\n   */\n  numEntries: 'Number of Entries',\n  /**\n   *@description The number of bits remaining in the origin's shared storage privacy budget\n   */\n  entropyBudget: 'Entropy Budget for Fenced Frames',\n  /**\n   *@description Hover text for `entropyBudget` giving a more detailed explanation\n   */\n  budgetExplanation: 'Remaining data leakage allowed within a 24-hour period for this origin in bits of entropy',\n  /**\n   *@description Label for a button which when clicked causes the budget to be reset to the max.\n   */\n  resetBudget: 'Reset Budget',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/application/components/SharedStorageMetadataView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\ninterface SharedStorageMetadataGetter {\n  getMetadata: () => Promise<Protocol.Storage.SharedStorageMetadata|null>;\n  resetBudget: () => Promise<void>;\n}\n\ninterface SharedStorageResetBudgetButtonData {\n  resetBudgetHandler: () => void;\n}\n\nclass SharedStorageResetBudgetButton extends HTMLElement {\n  static readonly litTagName = LitHtml.literal`devtools-shared-storage-reset-budget-button`;\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #resetBudgetHandler: (() => void) = () => {};\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [sharedStorageMetadataViewResetBudgetButtonStyles];\n  }\n\n  set data(data: SharedStorageResetBudgetButtonData) {\n    this.#resetBudgetHandler = data.resetBudgetHandler;\n    this.#render();\n  }\n\n  #render(): void {\n    // clang-format off\n    LitHtml.render(LitHtml.html`\n      <button class=\"reset-budget-button\"\n        title=${i18nString(UIStrings.resetBudget)}\n        @click=${(): void => this.#resetBudgetHandler()}>\n      <${IconButton.Icon.Icon.litTagName} .data=${\n      {iconName: 'undo', color: 'var(--icon-default)', width: '16px', height: '16px'} as\n      IconButton.Icon.IconWithName}>\n        </${IconButton.Icon.Icon.litTagName}>\n      </button>`, this.#shadow, {host: this});\n    // clang-format on\n  }\n}\n\nexport class SharedStorageMetadataView extends StorageMetadataView {\n  static override readonly litTagName = LitHtml.literal`devtools-shared-storage-metadata-view`;\n  #sharedStorageMetadataGetter: SharedStorageMetadataGetter;\n  #creationTime: Protocol.Network.TimeSinceEpoch|null = null;\n  #length: number = 0;\n  #remainingBudget: number = 0;\n\n  constructor(sharedStorageMetadataGetter: SharedStorageMetadataGetter, owner: string) {\n    super();\n    this.#sharedStorageMetadataGetter = sharedStorageMetadataGetter;\n    this.classList.add('overflow-auto');\n    this.setStorageKey(owner);\n  }\n\n  async #resetBudget(): Promise<void> {\n    await this.#sharedStorageMetadataGetter.resetBudget();\n    await this.render();\n  }\n\n  connectedCallback(): void {\n    this.getShadow().adoptedStyleSheets = [sharedStorageMetadataViewStyles];\n  }\n\n  override getTitle(): string {\n    return i18nString(UIStrings.sharedStorage);\n  }\n\n  override async renderReportContent(): Promise<LitHtml.LitTemplate> {\n    const metadata = await this.#sharedStorageMetadataGetter.getMetadata();\n    this.#creationTime = metadata?.creationTime ?? null;\n    this.#length = metadata?.length ?? 0;\n    this.#remainingBudget = metadata?.remainingBudget ?? 0;\n\n    // Disabled until https://crbug.com/1079231 is fixed.\n    // clang-format off\n    return LitHtml.html`\n      ${await super.renderReportContent()}\n      ${this.key(i18nString(UIStrings.creation))}\n      ${this.value(this.#renderDateForCreationTime())}\n      ${this.key(i18nString(UIStrings.numEntries))}\n      ${this.value(String(this.#length))}\n      ${this.key(LitHtml.html`${i18nString(UIStrings.entropyBudget)}<${IconButton.Icon.Icon.litTagName} class=\"info-icon\" title=${i18nString(UIStrings.budgetExplanation)}\n           .data=${{iconName: 'info', color: 'var(--icon-default)', width: '16px'} as IconButton.Icon.IconWithName}>\n         </${IconButton.Icon.Icon.litTagName}>`)}\n      ${this.value(LitHtml.html`${this.#remainingBudget}${this.#renderResetBudgetButton()}`)}`;\n    // clang-format on\n  }\n\n  #renderDateForCreationTime(): LitHtml.TemplateResult {\n    if (!this.#creationTime) {\n      return LitHtml.html`${i18nString(UIStrings.notYetCreated)}`;\n    }\n    const date = new Date(1e3 * (this.#creationTime as number));\n    return LitHtml.html`${date.toLocaleString()}`;\n  }\n\n  #renderResetBudgetButton(): LitHtml.TemplateResult {\n    // clang-format off\n    return LitHtml.html`<${SharedStorageResetBudgetButton.litTagName}\n     .data=${{resetBudgetHandler: this.#resetBudget.bind(this)} as SharedStorageResetBudgetButtonData}\n    ></${SharedStorageResetBudgetButton.litTagName}>`;\n    // clang-format on\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent(\n    'devtools-shared-storage-reset-budget-button', SharedStorageResetBudgetButton);\nComponentHelpers.CustomElements.defineComponent('devtools-shared-storage-metadata-view', SharedStorageMetadataView);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-shared-storage-metadata-view': SharedStorageMetadataView;\n    'devtools-shared-storage-reset-budget-button': SharedStorageResetBudgetButton;\n  }\n}\n"]}