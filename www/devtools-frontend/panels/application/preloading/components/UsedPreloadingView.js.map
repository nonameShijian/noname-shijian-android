{"version":3,"file":"UsedPreloadingView.js","sourceRoot":"","sources":["../../../../../../../../front_end/panels/application/preloading/components/UsedPreloadingView.ts"],"names":[],"mappings":"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","sourcesContent":["// Copyright 2023 The Chromium Authors. All rights reserved.\n// Use of this source code is governed by a BSD-style license that can be\n// found in the LICENSE file.\n\nimport * as i18n from '../../../../core/i18n/i18n.js';\nimport * as SDK from '../../../../core/sdk/sdk.js';\nimport * as Protocol from '../../../../generated/protocol.js';\nimport * as ComponentHelpers from '../../../../ui/components/helpers/helpers.js';\nimport * as LegacyWrapper from '../../../../ui/components/legacy_wrapper/legacy_wrapper.js';\nimport * as Coordinator from '../../../../ui/components/render_coordinator/render_coordinator.js';\nimport * as ReportView from '../../../../ui/components/report_view/report_view.js';\nimport * as LitHtml from '../../../../ui/lit-html/lit-html.js';\n\nimport type * as UI from '../../../../ui/legacy/legacy.js';\n\nconst UIStrings = {\n  /**\n   *@description Title for the panel\n   */\n  preloadingUsedForThisPage: 'Preloading used for this page',\n  /**\n   *@description Message that reports counts of prefetch that used for this page.\n   *@example {1} PH1\n   */\n  prefetchUsed: '{PH1} prefetched resources are used for this page',\n  /**\n   *@description Message that reports this page was prerendered.\n   */\n  prerenderUsed: 'This page was prerendered',\n};\nconst str_ = i18n.i18n.registerUIStrings('panels/application/preloading/components/UsedPreloadingView.ts', UIStrings);\nconst i18nString = i18n.i18n.getLocalizedString.bind(undefined, str_);\n\nconst coordinator = Coordinator.RenderCoordinator.RenderCoordinator.instance();\n\ntype UsedPreloadingViewData = SDK.PreloadingModel.PreloadingAttempt[];\n\nexport class UsedPreloadingView extends LegacyWrapper.LegacyWrapper.WrappableComponent<UI.Widget.VBox> {\n  static readonly litTagName = LitHtml.literal`devtools-resources-used-preloading-view`;\n\n  readonly #shadow = this.attachShadow({mode: 'open'});\n  #data: SDK.PreloadingModel.PreloadingAttempt[] = [];\n\n  connectedCallback(): void {\n    this.#shadow.adoptedStyleSheets = [];\n  }\n\n  set data(data: UsedPreloadingViewData) {\n    this.#data = data;\n    void this.#render();\n  }\n\n  async #render(): Promise<void> {\n    await coordinator.write('UsedPreloadingView render', () => {\n      const used = this.#data.filter(attempt => attempt.status === SDK.PreloadingModel.PreloadingStatus.Success);\n      const prefetchCount =\n          used.filter(attempt => attempt.key.action === Protocol.Preload.SpeculationAction.Prefetch).length;\n      const prerenderCount = used.length - prefetchCount;\n\n      let message = '';\n\n      if (used.length === 0) {\n        // TODO(https://crbug.com/1410709): Remake entire this view.\n        //\n        // For a while, we fill temporary string.\n        message = i18n.i18n.lockedString('No preloading was used for this page.');\n      } else if (prerenderCount > 0) {\n        message = i18nString(UIStrings.prerenderUsed);\n      } else if (prefetchCount > 0) {\n        message = i18nString(UIStrings.prefetchUsed, {PH1: prefetchCount});\n      }\n\n      // Disabled until https://crbug.com/1079231 is fixed.\n      // clang-format off\n      LitHtml.render(LitHtml.html`\n        <${ReportView.ReportView.Report.litTagName} .data=${\n            {reportTitle: i18nString(UIStrings.preloadingUsedForThisPage)} as ReportView.ReportView.ReportData\n        }>\n            <${ReportView.ReportView.ReportSection.litTagName}>\n                ${message}\n            </${ReportView.ReportView.ReportSection.litTagName}>\n        </${ReportView.ReportView.Report.litTagName}>\n      `, this.#shadow, {host: this});\n      // clang-format on\n    });\n  }\n}\n\nComponentHelpers.CustomElements.defineComponent('devtools-resources-used-preloading-view', UsedPreloadingView);\n\ndeclare global {\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  interface HTMLElementTagNameMap {\n    'devtools-resources-used-preloading-view': UsedPreloadingView;\n  }\n}\n"]}